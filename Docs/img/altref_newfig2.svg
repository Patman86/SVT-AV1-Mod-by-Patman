<svg width="1601" height="3353" viewBox="0 0 1601 3353" fill="none" xmlns="http://www.w3.org/2000/svg">
<defs>
    <style>
        @font-face {
            font-family: 'Inter';
            src: url('https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuLyfAZ9hiA.woff2') format('woff2');
        }
        @font-face {
            font-family: 'GitLab Mono';
            src: url('https://docs.gitlab.com/assets/vendor/GitLabMono.woff2') format('woff2');
        }
    </style>
</defs>

<rect width="1601" height="3353" fill="white"/>
<rect x="63" y="11" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="63" y="108" width="600" height="371" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="93" y="148" width="539" height="39" fill="#5B98D4" stroke="black" stroke-width="2"/>
<rect x="531.5" y="151.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<rect x="93" y="201" width="539" height="124" fill="#5B98D4" stroke="black" stroke-width="2"/>
<rect x="531.5" y="204.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<rect x="93" y="339" width="539" height="124" fill="#5B98D4" stroke="black" stroke-width="2"/>
<rect x="531.5" y="342.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<rect x="63" y="491" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<path d="M64.4142 627L104.414 587H621.586L661.586 627H64.4142Z" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="63" y="641" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="562.5" y="644.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<path d="M537 832C537 837.207 532.572 842.475 523.754 847.479C515.016 852.437 502.304 856.936 486.51 860.726C454.938 868.303 411.27 873 363 873C314.73 873 271.062 868.303 239.49 860.726C223.696 856.936 210.984 852.437 202.246 847.479C193.428 842.475 189 837.207 189 832C189 826.793 193.428 821.525 202.246 816.521C210.984 811.563 223.696 807.064 239.49 803.274C271.062 795.697 314.73 791 363 791C411.27 791 454.938 795.697 486.51 803.274C502.304 807.064 515.016 811.563 523.754 816.521C532.572 821.525 537 826.793 537 832Z" fill="#003972" stroke="black" stroke-width="2"/>
<path d="M537 1024C537 1029.21 532.572 1034.48 523.754 1039.48C515.016 1044.44 502.304 1048.94 486.51 1052.73C454.938 1060.3 411.27 1065 363 1065C314.73 1065 271.062 1060.3 239.49 1052.73C223.696 1048.94 210.984 1044.44 202.246 1039.48C193.428 1034.48 189 1029.21 189 1024C189 1018.79 193.428 1013.52 202.246 1008.52C210.984 1003.56 223.696 999.064 239.49 995.274C271.062 987.697 314.73 983 363 983C411.27 983 454.938 987.697 486.51 995.274C502.304 999.064 515.016 1003.56 523.754 1008.52C532.572 1013.52 537 1018.79 537 1024Z" fill="#003972" stroke="black" stroke-width="2"/>
<path d="M537 1216C537 1221.21 532.572 1226.48 523.754 1231.48C515.016 1236.44 502.304 1240.94 486.51 1244.73C454.938 1252.3 411.27 1257 363 1257C314.73 1257 271.062 1252.3 239.49 1244.73C223.696 1240.94 210.984 1236.44 202.246 1231.48C193.428 1226.48 189 1221.21 189 1216C189 1210.79 193.428 1205.52 202.246 1200.52C210.984 1195.56 223.696 1191.06 239.49 1187.27C271.062 1179.7 314.73 1175 363 1175C411.27 1175 454.938 1179.7 486.51 1187.27C502.304 1191.06 515.016 1195.56 523.754 1200.52C532.572 1205.52 537 1210.79 537 1216Z" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="63" y="887" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="562.5" y="890.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="212.294" y="52.0909">ME search Params (Full Pel, Sub Pel, Block-Size)&#x2028;</tspan><tspan x="221.104" y="68.0909">Min and Max number of Past &#38; Future Frames&#x2028;</tspan><tspan x="265.932" y="84.0909">Activity &#38; Noise-based Params</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="294.467" y="31.0909">Set default Params&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="266.042" y="526.317">Compute the Decay Factor&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="133.05" y="548.317">tf_decay_factor = 2 * n_decay * n_decay * q_decay * s_decay</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="278.01" y="677.091">Reset accum and count&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="187.449" y="698.091">Reset the per Pixel accumulator and counter for filtering</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="337.121" y="828.727">Check if&#x2028;</tspan><tspan x="318.643" y="844.727">Central Frame</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="409.522" y="1036.95">me_exit_th</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="337.121" y="1019.95">Check if&#x2028;</tspan><tspan x="238.529" y="1036.95">HME distortion is less than </tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="290.161" y="1203.95"> </tspan><tspan x="479.892" y="1203.95">&#x2028;</tspan><tspan x="243.721" y="1219.95"> </tspan><tspan x="259.755" y="1219.95"> </tspan><tspan x="283.75" y="1219.95"> </tspan><tspan x="503.163" y="1219.95">&#x2028;</tspan><tspan x="272.489" y="1236.95"> </tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="307.388" y="1236.95">use_pred_64x64_only_th</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="238.402" y="1203.95">Check if</tspan><tspan x="293.385" y="1203.95">the 64x64 ME distortion to the</tspan><tspan x="215.703" y="1219.95">Sum</tspan><tspan x="246.946" y="1219.95">of</tspan><tspan x="262.98" y="1219.95">the</tspan><tspan x="286.974" y="1219.95">4 32x32 ME distortions deviation is</tspan><tspan x="247.124" y="1236.95">less</tspan><tspan x="275.713" y="1236.95">than </tspan></text>
<path d="M537 1462C537 1467.21 532.572 1472.48 523.754 1477.48C515.016 1482.44 502.304 1486.94 486.51 1490.73C454.938 1498.3 411.27 1503 363 1503C314.73 1503 271.062 1498.3 239.49 1490.73C223.696 1486.94 210.984 1482.44 202.246 1477.48C193.428 1472.48 189 1467.21 189 1462C189 1456.79 193.428 1451.52 202.246 1446.52C210.984 1441.56 223.696 1437.06 239.49 1433.27C271.062 1425.7 314.73 1421 363 1421C411.27 1421 454.938 1425.7 486.51 1433.27C502.304 1437.06 515.016 1441.56 523.754 1446.52C532.572 1451.52 537 1456.79 537 1462Z" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="230.715" y="1466.45">pred_error</tspan><tspan x="324" y="1483.45">pred_error_32x32_th</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="337.121" y="1449.45">Check if&#x2028;</tspan><tspan x="308.664" y="1466.45"> of the parent 32x32 is higher&#x2028;</tspan><tspan x="253.896" y="1483.45">or equal to </tspan></text>
<path d="M537 1771C537 1771.86 536.242 1773.02 533.939 1774.37C531.716 1775.67 528.373 1776.96 523.975 1778.21C515.194 1780.7 502.44 1782.96 486.625 1784.86C455.006 1788.65 411.298 1791 363 1791C314.702 1791 270.994 1788.65 239.375 1784.86C223.56 1782.96 210.806 1780.7 202.025 1778.21C197.627 1776.96 194.284 1775.67 192.061 1774.37C189.758 1773.02 189 1771.86 189 1771C189 1770.14 189.758 1768.98 192.061 1767.63C194.284 1766.33 197.627 1765.04 202.025 1763.79C210.806 1761.3 223.56 1759.04 239.375 1757.14C270.994 1753.35 314.702 1751 363 1751C411.298 1751 455.006 1753.35 486.625 1757.14C502.44 1759.04 515.194 1761.3 523.975 1763.79C528.373 1765.04 531.716 1766.33 533.939 1767.63C536.242 1768.98 537 1770.14 537 1771Z" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="306.766" y="1775.73">Next 32x32 Block</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="195.105" y="172.955">Compute the Noise level for the Central Frame</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="204.429" y="132.455">Update the number of Past &#38; Future Frames</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="541.919" y="163.636">Luma &#38; Chroma</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="572.919" y="656.636">Luma &#38; Chroma</tspan></text>
<path d="M363 886L365.887 881L360.113 881L363 886ZM362.5 874L362.5 881.5L363.5 881.5L363.5 874L362.5 874Z" fill="black"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="314.858" y="923.091">Perform HME&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="286.911" y="944.091">(central-to-Past/Future)</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="585.424" y="902.636">Luma Only</tspan></text>
<rect x="63" y="1325" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="562.5" y="1328.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="254.638" y="1360.32">Perform Subpel for the 32x32&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="168.159" y="1382.32">Keep track of the best 32x32 pred error = </tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="433.123" y="1382.32">32x32_pred_error</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="585.424" y="1340.64">Luma Only</tspan></text>
<rect x="63" y="1517" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="562.5" y="1520.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="189.973" y="1552.32">Perform subpel for each of the 4 16x16 Block(s)&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="157.964" y="1574.32">Keep track of the best 16x16 </tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="341.107" y="1574.32">pred_error</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="419.056" y="1574.32"> (MAX if not performed)</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="585.424" y="1532.64">Luma Only</tspan></text>
<rect x="63" y="1805" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="562.5" y="1808.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="207.192" y="1851.45">Derive Final Prediction for the 64x64 Block</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="572.919" y="1820.64">Luma &#38; Chroma</tspan></text>
<rect x="63" y="1613" width="600" height="124" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="210.356" y="1635.82">Select a Partitioning for each 32x32 Block&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="238.814" y="1656.82">Use 32x32 if (1) or (2), else the 4 16x16&#x2028;</tspan><tspan x="134.891" y="1673.82">(1) </tspan><tspan x="133.977" y="1707.82">(2) </tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="154.594" y="1673.82">(((32x32_pred_error * 15 &#60; sum_16x16_pred_error * 16) &#38;&#38; </tspan><tspan x="160.332" y="1690.82">max_16x16_pred_error - min_16x16_pred_error &#60; 12000)&#x2028;</tspan><tspan x="155.508" y="1707.82">(((32x32_pred_error * 14 &#60; sum_16x16_pred_error * 16) &#38;&#38; </tspan><tspan x="164.229" y="1724.82">max_16x16_pred_error - min_16x16_pred_error &#60; 6000)</tspan></text>
<rect x="677" y="1325" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="1176.5" y="1328.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="868.008" y="1371.45">Perform Subpel for the 64x64</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="1199.42" y="1340.64">Luma Only</tspan></text>
<rect x="63" y="1079" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="277.299" y="1115.09">Perform Full-Pel Search&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="286.911" y="1136.09">(central-to-Past/Future)</tspan></text>
<rect x="990" y="2562" width="600" height="82" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="1199.22" y="2588.82">Update accum and count&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="1091.23" y="2610.82">accum[pixel_index] += </tspan><tspan x="1379.64" y="2610.82"> * Pixel Value&#x2028;</tspan><tspan x="1145.79" y="2627.82">count[pixel_index] += </tspan></text>
<text fill="#CD00FF" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="1262.72" y="2610.82">TF_WEIGHT_SCALE</tspan><tspan x="1317.28" y="2627.82">TF_WEIGHT_SCALE</tspan></text>
<rect x="1489.5" y="2565.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="1499.92" y="2577.64">Luma &#38; Chroma</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="273.579" y="242.091">Noise-based adjustment&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="102.848" y="263.091">Increment the number of frames based on the noise level of the central frame: +6 if </tspan><tspan x="114.102" y="279.091">noise_level &#60; 0.5, else +4 if noise_level &#60; 1.0, else +2 if noise_level &#60; 2.0, else no </tspan><tspan x="275.942" y="295.091">action (by half at each side)</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="554.424" y="216.636">Luma Only</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="265.835" y="371.091">Activity-based adjustment&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="102.373" y="392.091">Decrement the number of frames based on the activity level = the abs diff between </tspan><tspan x="112.701" y="409.091">the histograms of the central frame and each of the last past/future frame (</tspan><tspan x="607.183" y="409.091">)&#x2028;</tspan><tspan x="99.0469" y="426.091">At each side, if active frame (</tspan><tspan x="374.865" y="426.091">) then decrement and move towards the </tspan><tspan x="290.968" y="442.091">central frame, else exit</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="583.798" y="409.091">ahd</tspan><tspan x="281.326" y="426.091">ahd &#62; ahd_th</tspan></text>
<rect x="63" y="2951" width="600" height="269" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="554.424" y="354.636">Luma Only</tspan></text>
<rect x="63" y="1955" width="600" height="874" fill="#003972" stroke="black" stroke-width="2"/>
<rect x="93" y="2020" width="539" height="39" fill="#5B98D4" stroke="black" stroke-width="2"/>
<rect x="562.5" y="1958.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<rect x="93" y="2073" width="539" height="124" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="103.21" y="2044.82">Derive the error per pixel </tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="286.608" y="2044.82">(block_error_per_pixel) = block_error/32*32</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="136.021" y="1991.95">Generate a weight for each Pixel and accumulate the output(s)</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="572.919" y="1970.64">Luma &#38; Chroma</tspan></text>
<rect x="562.5" y="2954.5" width="97" height="17" fill="#ADCBE9" stroke="black"/>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="572.919" y="2966.64">Luma &#38; Chroma</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="159.766" y="2112.32">Compute the Distance Factor (only if use_fast_filter = 0)&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="163.729" y="2134.32">distance = sqrtf(powf(mv.row, 2) + powf(mv.col, 2))&#x2028;</tspan><tspan x="116.96" y="2151.32">distance_th = MAX(frame_size, </tspan><tspan x="569.065" y="2151.32">, 1);&#x2028;</tspan><tspan x="175.422" y="2168.32">d_factor = MAX(distance / distance_threshold, 1)</tspan></text>
<text fill="#6E0089" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="350.808" y="2151.32">TF_SEARCH_DISTANCE_THRESHOLD</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="135.245" y="2987.95">Normalize the accumulated data towards a filtered 64x64 Block</tspan></text>
<rect x="97" y="2265" width="539" height="124" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="278.104" y="2304.32">Derive the Window Error&#x2028;</tspan><tspan x="271.9" y="2322.32">(only if use_fast_filter = 0)&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="136.55" y="2360.32">window_error = sum_surrounding_error / num_ref_pixels (=25)</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="201.95" y="2343.32">Sum up the 5x5 error(s) surrounding the target Pixel&#x2028;</tspan></text>
<rect x="97" y="2403" width="539" height="124" fill="#5B98D4" stroke="black" stroke-width="2"/>
<path d="M541 2795C541 2795.86 540.242 2797.02 537.939 2798.37C535.716 2799.67 532.373 2800.96 527.975 2802.21C519.194 2804.7 506.44 2806.96 490.625 2808.86C459.006 2812.65 415.298 2815 367 2815C318.702 2815 274.994 2812.65 243.375 2808.86C227.56 2806.96 214.806 2804.7 206.025 2802.21C201.627 2800.96 198.284 2799.67 196.061 2798.37C193.758 2797.02 193 2795.86 193 2795C193 2794.14 193.758 2792.98 196.061 2791.63C198.284 2790.33 201.627 2789.04 206.025 2787.79C214.806 2785.3 227.56 2783.04 243.375 2781.14C274.994 2777.35 318.702 2775 367 2775C415.298 2775 459.006 2777.35 490.625 2781.14C506.44 2783.04 519.194 2785.3 527.975 2787.79C532.373 2789.04 535.716 2790.33 537.939 2791.63C540.242 2792.98 541 2794.14 541 2795Z" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="335.719" y="2799.73">Next Pixel</tspan></text>
<path d="M83 3186H82C82 3186.55 82.4477 3187 83 3187V3186ZM83 3036V3035C82.4477 3035 82 3035.45 82 3036H83ZM115 3036L105 3030.23V3041.77L115 3036ZM193 3185H83V3187H193V3185ZM84 3186L84 3036H82L82 3186H84ZM83 3037H106V3035H83V3037Z" fill="#5B98D4"/>
<path d="M541 3186C541 3186.86 540.242 3188.02 537.939 3189.37C535.716 3190.67 532.373 3191.96 527.975 3193.21C519.194 3195.7 506.44 3197.96 490.625 3199.86C459.006 3203.65 415.298 3206 367 3206C318.702 3206 274.994 3203.65 243.375 3199.86C227.56 3197.96 214.806 3195.7 206.025 3193.21C201.627 3191.96 198.284 3190.67 196.061 3189.37C193.758 3188.02 193 3186.86 193 3186C193 3185.14 193.758 3183.98 196.061 3182.63C198.284 3181.33 201.627 3180.04 206.025 3178.79C214.806 3176.3 227.56 3174.04 243.375 3172.14C274.994 3168.35 318.702 3166 367 3166C415.298 3166 459.006 3168.35 490.625 3172.14C506.44 3174.04 519.194 3176.3 527.975 3178.79C532.373 3180.04 535.716 3181.33 537.939 3182.63C540.242 3183.98 541 3185.14 541 3186Z" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="335.719" y="3190.73">Next Pixel</tspan></text>
<path d="M541 2863C541 2863.86 540.242 2865.02 537.939 2866.37C535.716 2867.67 532.373 2868.96 527.975 2870.21C519.194 2872.7 506.44 2874.96 490.625 2876.86C459.006 2880.65 415.298 2883 367 2883C318.702 2883 274.994 2880.65 243.375 2876.86C227.56 2874.96 214.806 2872.7 206.025 2870.21C201.627 2868.96 198.284 2867.67 196.061 2866.37C193.758 2865.02 193 2863.86 193 2863C193 2862.14 193.758 2860.98 196.061 2859.63C198.284 2858.33 201.627 2857.04 206.025 2855.79C214.806 2853.3 227.56 2851.04 243.375 2849.14C274.994 2845.35 318.702 2843 367 2843C415.298 2843 459.006 2845.35 490.625 2849.14C506.44 2851.04 519.194 2853.3 527.975 2855.79C532.373 2857.04 535.716 2858.33 537.939 2859.63C540.242 2860.98 541 2862.14 541 2863Z" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="310.766" y="2867.73">Next 32x32 Block</tspan></text>
<path d="M541 3254C541 3254.86 540.242 3256.02 537.939 3257.37C535.716 3258.67 532.373 3259.96 527.975 3261.21C519.194 3263.7 506.44 3265.96 490.625 3267.86C459.006 3271.65 415.298 3274 367 3274C318.702 3274 274.994 3271.65 243.375 3267.86C227.56 3265.96 214.806 3263.7 206.025 3261.21C201.627 3259.96 198.284 3258.67 196.061 3257.37C193.758 3256.02 193 3254.86 193 3254C193 3253.14 193.758 3251.98 196.061 3250.63C198.284 3249.33 201.627 3248.04 206.025 3246.79C214.806 3244.3 227.56 3242.04 243.375 3240.14C274.994 3236.35 318.702 3234 367 3234C415.298 3234 459.006 3236.35 490.625 3240.14C506.44 3242.04 519.194 3244.3 527.975 3246.79C532.373 3248.04 535.716 3249.33 537.939 3250.63C540.242 3251.98 541 3253.14 541 3254Z" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="310.22" y="3258.73">Next 64x64 Block</tspan></text>
<path d="M541 2917C541 2917.86 540.242 2919.02 537.939 2920.37C535.716 2921.67 532.373 2922.96 527.975 2924.21C519.194 2926.7 506.44 2928.96 490.625 2930.86C459.006 2934.65 415.298 2937 367 2937C318.702 2937 274.994 2934.65 243.375 2930.86C227.56 2928.96 214.806 2926.7 206.025 2924.21C201.627 2922.96 198.284 2921.67 196.061 2920.37C193.758 2919.02 193 2917.86 193 2917C193 2916.14 193.758 2914.98 196.061 2913.63C198.284 2912.33 201.627 2911.04 206.025 2909.79C214.806 2907.3 227.56 2905.04 243.375 2903.14C274.994 2899.35 318.702 2897 367 2897C415.298 2897 459.006 2899.35 490.625 2903.14C506.44 2905.04 519.194 2907.3 527.975 2909.79C532.373 2911.04 535.716 2912.33 537.939 2913.63C540.242 2914.98 541 2916.14 541 2917Z" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="297.315" y="2921.73">Next Reference Frame</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="158.609" y="2441.82">Combine/Normalize the Window Error and the Block Error&#x2028;</tspan><tspan x="271.9" y="2459.82">(only if use_fast_filter = 0)&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="113.165" y="2481.82">combined_error = (</tspan><tspan x="487.321" y="2481.82"> * window_error + </tspan><tspan x="124.857" y="2498.82">block_error_per_pixel) / (</tspan><tspan x="561.373" y="2498.82"> + 1);</tspan></text>
<text fill="#6E0089" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="253.474" y="2481.82">TF_WINDOW_BLOCK_BALANCE_WEIGHT</tspan><tspan x="327.525" y="2498.82">TF_WINDOW_BLOCK_BALANCE_WEIGHT</tspan></text>
<rect x="97" y="2541" width="539" height="124" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="285.208" y="2580.32">Compute Filter Weight&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="97.5752" y="2602.32">scaled_diff = (use_fast_filter)? MIN(block_error /tf_decay_factor, 7) </tspan><tspan x="159.935" y="2619.32">: MIN(combined_error * d_factor / tf_decay_factor, 7)&#x2028;</tspan><tspan x="97.5752" y="2636.32">adjusted_weight = (approximate_expdf(-scaled_diff) * </tspan><tspan x="627.63" y="2636.32">)</tspan></text>
<text fill="#6E0089" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="510.706" y="2636.32">TF_WEIGHT_SCALE</tspan></text>
<rect x="97" y="2679" width="539" height="82" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="275.716" y="2705.82">Update accum and count&#10;</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="167.729" y="2727.82">accum[pixel_index] += adjusted_weight * Pixel Value&#x2028;</tspan><tspan x="222.294" y="2744.82">count[pixel_index] += adjusted_weight</tspan></text>
<rect x="97" y="3070" width="539" height="82" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="GitLab Mono" font-size="13" font-weight="600" letter-spacing="0em"><tspan x="261.269" y="3107.18">Filtered_src[pixel_index] =&#x2028;</tspan><tspan x="105.37" y="3124.18">accum[pixel_index] + (count[pixel_index] &#62;&#62; 1) / count[pixel_index]</tspan></text>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="285.298" y="612.455">For each 64x64 Block</tspan></text>
<path d="M64.4142 777L104.414 737H621.586L661.586 777H64.4142Z" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="212.078" y="762.455">From the distant Past to the distant Future</tspan></text>
<path d="M64.4142 1311L104.414 1271H621.586L661.586 1311H64.4142Z" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="285.928" y="1296.45">For each 32x32 Block</tspan></text>
<path d="M64.4142 1941L104.414 1901H621.586L661.586 1941H64.4142Z" fill="#003972" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="285.928" y="1926.45">For each 32x32 Block</tspan></text>
<path d="M94.2431 2251L130.19 2211H594.81L630.757 2251H94.2431Z" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="314.219" y="2236.45">For each Pixel</tspan></text>
<path d="M98.2431 3056L134.19 3016H598.81L634.757 3056H98.2431Z" fill="#5B98D4" stroke="black" stroke-width="2"/>
<text fill="white" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="15" font-weight="600" letter-spacing="0em"><tspan x="318.219" y="3041.45">For each Pixel</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="367.252" y="883.636">No</tspan></text>
<path d="M363 1078L365.887 1073L360.113 1073L363 1078ZM362.5 1066L362.5 1073.5L363.5 1073.5L363.5 1066L362.5 1066Z" fill="black"/>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="367.252" y="1075.64">No</tspan></text>
<path d="M363 1270L365.887 1265L360.113 1265L363 1270ZM362.5 1258L362.5 1265.5L363.5 1265.5L363.5 1258L362.5 1258Z" fill="black"/>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="367.252" y="1267.64">No</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="62.252" y="1458.64">No</tspan></text>
<path d="M363 1516L365.887 1511L360.113 1511L363 1516ZM362.5 1504L362.5 1511.5L363.5 1511.5L363.5 1504L362.5 1504Z" fill="black"/>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="367.279" y="1513.64">Yes</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="924.279" y="1016.64">Yes</tspan></text>
<text fill="black" xml:space="preserve" style="white-space: pre" font-family="Inter" font-size="10" font-weight="600" letter-spacing="0em"><tspan x="924.279" y="1208.64">Yes</tspan></text>
<path d="M977 1024H978C978 1023.45 977.552 1023 977 1023V1024ZM977 1324L982.773 1314H971.227L977 1324ZM537 1025H977V1023H537V1025ZM976 1024V1315H978V1024H976Z" fill="black"/>
<path d="M1290 832H1291C1291 831.448 1290.55 831 1290 831V832ZM1290 2561L1295.77 2551H1284.23L1290 2561ZM537 833H1290V831H537V833ZM1289 832V2552H1291V832H1289Z" fill="black"/>
<line x1="537" y1="1216" x2="976" y2="1216" stroke="black" stroke-width="2"/>
<path d="M49 1462V1461C48.4477 1461 48 1461.45 48 1462H49ZM49 1675H48C48 1675.55 48.4477 1676 49 1676V1675ZM62 1675L52 1669.23V1680.77L62 1675ZM189 1461H49V1463H189V1461ZM48 1462L48 1675H50L50 1462H48ZM49 1676H53V1674H49V1676Z" fill="black"/>
<path d="M35 1771H34C34 1771.55 34.4477 1772 35 1772V1771ZM35 1291V1290C34.4477 1290 34 1290.45 34 1291H35ZM83 1291L73 1285.23V1296.77L83 1291ZM189 1770H35V1772H189V1770ZM36 1771L36 1291H34L34 1771H36ZM35 1292H74V1290H35V1292Z" fill="black"/>
<path d="M83 2795H82C82 2795.55 82.4477 2796 83 2796V2795ZM83 2231V2230C82.4477 2230 82 2230.45 82 2231H83ZM111 2231L101 2225.23V2236.77L111 2231ZM193 2794H83V2796H193V2794ZM84 2795L84 2231H82L82 2795H84ZM83 2232H102V2230H83V2232Z" fill="#5B98D4"/>
<path d="M35 2863H34C34 2863.55 34.4477 2864 35 2864V2863ZM35 1921V1920C34.4477 1920 34 1920.45 34 1921H35ZM83 1921L73 1915.23V1926.77L83 1921ZM193 2862H35V2864H193V2862ZM36 2863L36 1921H34L34 2863H36ZM35 1922H74V1920H35V1922Z" fill="black"/>
<path d="M23 2917H22C22 2917.55 22.4477 2918 23 2918V2917ZM23 757V756C22.4477 756 22 756.448 22 757H23ZM83 757L73 751.227V762.773L83 757ZM193 2916H23V2918H193V2916ZM24 2917L24 757H22L22 2917H24ZM23 758H74V756H23V758Z" fill="black"/>
<path d="M11 3254H10C10 3254.55 10.4477 3255 11 3255V3254ZM11 607V606C10.4477 606 10 606.448 10 607H11ZM83 607L73 601.227V612.773L83 607ZM193 3253H11V3255H193V3253ZM12 3254L12 607H10L10 3254H12ZM11 608H74V606H11V608Z" fill="black"/>
<path d="M977 1846V1847C977.552 1847 978 1846.55 978 1846H977ZM664 1846L674 1851.77V1840.23L664 1846ZM976 1408V1846H978V1408H976ZM977 1845H673V1847H977V1845Z" fill="black"/>
<path d="M1290 2917V2918C1290.55 2918 1291 2917.55 1291 2917H1290ZM542 2917L552 2922.77V2911.23L542 2917ZM1289 2645V2917H1291V2645H1289ZM1290 2916H551V2918H1290V2916Z" fill="black"/>
</svg>
